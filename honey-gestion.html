<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Honey | Smart Tech Management</title>
    
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <style>
        :root { --naranja: #f39c12; --amarillo: #f1c40f; --negro: #0d0d0d; --rojo: #e74c3c; --verde: #2ecc71; --azul: #2980b9; }
        
        body { font-family: 'Segoe UI', sans-serif; background: var(--negro); color: white; margin:0; overflow-x: hidden; }

        /* --- SISTEMA DE PUERTAS --- */
        #gate-container {
            position: fixed; inset: 0; z-index: 9999;
            display: flex; pointer-events: none;
        }
        .gate-panel {
            width: 50%; height: 100%;
            background: #1a1a1a; 
            display: flex; align-items: center;
            position: relative;
            border-bottom: 10px solid var(--naranja);
        }
        
        .gate-left { 
            justify-content: flex-end; 
            border-right: 2px solid var(--naranja);
        }
        .gate-right { 
            justify-content: flex-start; 
            border-left: 2px solid var(--naranja);
        }
        
        .gate-logo {
            font-size: clamp(2.5rem, 12vw, 5rem);
            font-weight: 900; 
            color: var(--naranja);
            font-family: 'Arial Black', sans-serif;
            z-index: 10;
        }

        /* --- CONTENIDO --- */
        .main-wrapper {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            opacity: 0;
        }

        .card { 
            background: #161616; 
            padding: 20px; 
            border-radius: 15px; 
            margin-bottom: 15px; 
            border: 1px solid #222; 
        }

        input { 
            width: 100%; 
            padding: 14px; 
            margin: 8px 0; 
            border-radius: 10px; 
            border: 1px solid #333; 
            background: #000; 
            color: white; 
            font-size: 16px; /* Evita zoom en iPhone */
            box-sizing: border-box; 
        }

        .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 0.9rem; text-transform: uppercase; }
        .btn-scan { background: var(--amarillo); color: black; }
        .btn-save { background: var(--verde); color: white; margin-top: 10px; }
        .btn-exit { background: transparent; color: var(--rojo); border: 1px solid var(--rojo); margin-top: 20px; margin-bottom: 50px;}
        
        .tabla-contenedor { 
            overflow-x: auto; 
            margin-top: 10px; 
            background: #000; 
            border-radius: 10px;
        }
        .tabla-inventario { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .tabla-inventario th { background: #222; color: var(--amarillo); padding: 12px; text-align: left; }
        .tabla-inventario td { padding: 12px; border-bottom: 1px solid #111; }
    </style>
</head>
<body>

    <div id="gate-container">
        <div class="gate-panel gate-left"><span class="gate-logo">HO</span></div>
        <div class="gate-panel gate-right"><span class="gate-logo">NEY</span></div>
    </div>

    <div class="main-wrapper" id="content">
        <div style="text-align: center; margin-top: 20px;">
            <h2 style="color: var(--naranja); margin-bottom: 5px;">HONEY STORE</h2>
            <p style="font-size: 0.7rem; color: #666; letter-spacing: 2px;">INVENTORY_MANAGEMENT_V2</p>
        </div>
        
        <div id="reader" style="width: 100%; border-radius: 15px; overflow: hidden; border: 1px solid var(--amarillo); margin: 15px 0; background: #000;"></div>
        <button class="btn btn-scan" onclick="iniciarEscaneo()">ðŸ“· SCAN_PRODUCT</button>

        <div class="card">
            <h3 style="font-size: 0.8rem; color: var(--amarillo); margin-bottom: 15px;">EDITOR DE PRODUCTO</h3>
            <input type="text" id="cod" placeholder="Barcode">
            <input type="text" id="nom" placeholder="Product Name">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <input type="number" id="pre" placeholder="Price $" inputmode="decimal">
                <input type="number" id="sto" placeholder="Stock" inputmode="numeric">
            </div>
            <button class="btn btn-save" onclick="guardarProducto()">SYNC_TO_CLOUD</button>
        </div>

        <div class="card">
            <h3 style="font-size: 0.8rem; color: var(--amarillo); margin-bottom: 15px;">INVENTARIO ACTUAL</h3>
            <div class="tabla-contenedor">
                <table class="tabla-inventario">
                    <thead>
                        <tr><th>Producto</th><th>Precio</th><th>Stock</th></tr>
                    </thead>
                    <tbody id="cuerpo-tabla"></tbody>
                </table>
            </div>
        </div>

        <button class="btn btn-exit" onclick="cerrarSistema()">ðŸ”´ EXIT_SYSTEM</button>
    </div>

<script>
    // --- APERTURA ---
    window.addEventListener('load', () => {
        const tl = gsap.timeline();
        tl.to(".gate-left", { x: "-100%", duration: 1.5, ease: "expo.inOut" }, "+=0.3")
          .to(".gate-right", { x: "100%", duration: 1.5, ease: "expo.inOut" }, "<")
          .to("#content", { opacity: 1, duration: 0.5 }, "-=0.5")
          .set("#gate-container", { display: "none" });
        
        cargarListaMercaderia();
    });

    // --- CIERRE CON REDIRECCIÃ“N ---
    function cerrarSistema() {
        gsap.set("#gate-container", { display: "flex" });
        gsap.timeline()
            .to(".gate-left", { x: "0%", duration: 1, ease: "expo.inOut" })
            .to(".gate-right", { x: "0%", duration: 1, ease: "expo.inOut" }, "<")
            .call(() => { 
                // AquÃ­ es donde ocurre la magia: volvemos al index de Smart Tech
                window.location.href = "index.html"; 
            });
    }

    const SB_URL = "https://svpurpvbiujhcbiugrkh.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN2cHVycHZiaXVqaGNiaXVncmtoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NDgzMTUsImV4cCI6MjA4MzMyNDMxNX0.AivKJ0_N0z_4T4vLNfUcE2hepJ1XXOO8-4fSA3PJXdc";
    const _supabase = supabase.createClient(SB_URL, SB_KEY);
    
    async function cargarListaMercaderia() {
        const { data } = await _supabase.from('productos_demo').select('*').order('nombre', { ascending: true });
        let html = "";
        if(data) {
            data.forEach(p => {
                html += `<tr><td>${p.nombre}</td><td>$${p.precio}</td><td>${p.stock}</td></tr>`;
            });
            document.getElementById('cuerpo-tabla').innerHTML = html;
        }
    }

    function iniciarEscaneo() {
        const scanner = new Html5Qrcode("reader");
        scanner.start({ facingMode: "environment" }, { fps: 15, qrbox: 250 }, (codigo) => {
            document.getElementById('cod').value = codigo;
            scanner.stop();
        }).catch(err => console.log(err));
    }

    async function guardarProducto() {
        const cod = document.getElementById('cod').value;
        const nom = document.getElementById('nom').value;
        const pre = document.getElementById('pre').value;
        const sto = document.getElementById('sto').value;
        
        if(!nom || !pre) return alert("Faltan datos");

        const { error } = await _supabase.from('productos_demo').upsert({
            codigo_barras: cod || "D-" + Math.floor(Math.random()*1000),
            nombre: nom, precio: parseFloat(pre), stock: parseInt(sto) || 0
        });

        if(!error) {
            alert("Sincronizado con Supabase");
            cargarListaMercaderia();
        }
    }
</script>
</body>
</html>
