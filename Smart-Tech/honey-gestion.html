
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#f39c12">
    <title>DEMO - Gesti√≥n Almac√©n Honey</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        :root { --naranja: #f39c12; --amarillo: #f1c40f; --negro: #1a1a1a; --rojo: #e74c3c; --verde: #2ecc71; --azul: #2980b9; }
        body { font-family: sans-serif; background: var(--negro); color: white; padding: 10px; text-align: center; margin:0; }
        .card { background: #2c3e50; padding: 15px; border-radius: 15px; margin-bottom: 15px; text-align: left; border: 1px solid #444; }
        input { width: 100%; padding: 10px; margin: 5px 0; border-radius: 8px; border: none; box-sizing: border-box; font-size: 1rem; background: white; color: black; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-scan { background: var(--amarillo); color: black; }
        .btn-save { background: var(--verde); color: white; }
        .btn-delete { background: var(--rojo); color: white; margin-top: 10px; }
        .btn-nav { background: #555; color: white; margin-bottom: 10px; }
        h2, h3 { color: var(--amarillo); margin: 5px 0; }
        .tabla-contenedor { overflow-x: auto; margin-top: 10px; background: #1a1a1a; border-radius: 10px; }
        .tabla-inventario { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .tabla-inventario th { background: #444; color: var(--amarillo); padding: 10px; text-align: left; }
        .tabla-inventario td { padding: 10px; border-bottom: 1px solid #333; }
        .badge-demo { background: var(--azul); color: white; padding: 5px 10px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; }
    </style>
</head>
<body>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <span class="badge-demo">MODO DEMOSTRACI√ìN</span>
    </div>

    <h2>üçØ Demo Gesti√≥n Almac√©n</h2>
    <p style="font-size: 0.8rem; color: #aaa;">Esta es una versi√≥n de prueba. Los datos son p√∫blicos.</p>
    
    <div id="reader" style="width: 100%; border-radius: 15px; overflow: hidden; border: 2px solid var(--amarillo); margin-bottom:10px;"></div>
    <button class="btn btn-scan" onclick="iniciarEscaneo()">üì∑ PROBAR ESC√ÅNER</button>

    <div class="card">
        <h3>üì¶ Editor (Prueba Guardar)</h3>
        <input type="text" id="cod" placeholder="C√≥digo de barras">
        <input type="text" id="nom" placeholder="Nombre del producto">
        <input type="number" id="pre" placeholder="Precio Venta $">
        <input type="number" id="sto" placeholder="Stock">
        
        <div style="display: flex; gap: 10px;">
            <button class="btn btn-save" onclick="guardarProducto()">üíæ GUARDAR CAMBIOS</button>
            <button class="btn btn-nav" onclick="limpiarFormulario()">üßπ LIMPIAR</button>
        </div>
    </div>

    <div class="card">
        <h3>üìã Lista de Mercader√≠a</h3>
        <div class="tabla-contenedor">
            <table class="tabla-inventario">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Venta</th>
                        <th>Stock</th>
                    </tr>
                </thead>
                <tbody id="cuerpo-tabla"></tbody>
            </table>
        </div>
    </div>

<script>
    const SB_URL = "https://svpurpvbiujhcbiugrkh.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN2cHVycHZiaXVqaGNiaXVncmtoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3NDgzMTUsImV4cCI6MjA4MzMyNDMxNX0.AivKJ0_N0z_4T4vLNfUcE2hepJ1XXOO8-4fSA3PJXdc";
    const _supabase = supabase.createClient(SB_URL, SB_KEY);
    const scanner = new Html5Qrcode("reader");

    window.onload = () => { cargarListaMercaderia(); };

    function iniciarEscaneo() {
        scanner.start({ facingMode: "environment" }, { fps: 15, qrbox: 250 }, (codigo) => {
            document.getElementById('cod').value = codigo;
            verificarExistencia(codigo);
            scanner.stop();
        }).catch(err => alert("Error: " + err));
    }

    async function verificarExistencia(codigo) {
        const { data } = await _supabase.from('productos_demo').select('*').eq('codigo_barras', codigo).maybeSingle();
        if (data) cargarEnFormulario(data);
    }

    function cargarEnFormulario(p) {
        document.getElementById('cod').value = p.codigo_barras;
        document.getElementById('nom').value = p.nombre;
        document.getElementById('pre').value = p.precio;
        document.getElementById('sto').value = p.stock;
    }

    function limpiarFormulario() {
        document.getElementById('cod').value = "";
        document.getElementById('nom').value = "";
        document.getElementById('pre').value = "";
        document.getElementById('sto').value = "";
    }

    async function guardarProducto() {
        const cod = document.getElementById('cod').value;
        const nom = document.getElementById('nom').value;
        const pre = document.getElementById('pre').value;
        if(!nom || !pre) return alert("Completa nombre y precio");

        const { error } = await _supabase.from('productos_demo').upsert({
            codigo_barras: cod || "D-" + Math.floor(Math.random()*1000),
            nombre: nom, 
            precio: parseFloat(pre), 
            stock: parseInt(document.getElementById('sto').value) || 0 
        }, { onConflict: 'codigo_barras' });

        if(error) alert("Error: " + error.message);
        else {
            alert("‚úÖ ¬°Funciona! Producto guardado en la demo.");
            limpiarFormulario();
            cargarListaMercaderia();
        }
    }

    async function cargarListaMercaderia() {
        const { data } = await _supabase.from('productos_demo').select('*').order('nombre', { ascending: true });
        let html = "";
        data.forEach(p => {
            html += `<tr>
                <td>${p.nombre}</td>
                <td>$${p.precio}</td>
                <td>${p.stock}</td>
            </tr>`;
        });
        document.getElementById('cuerpo-tabla').innerHTML = html;
    }
</script>
</body>
</html>
